<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>mainCard</title>

  <!-- CSS ì´ˆê¸°í™” -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reset-css@5.0.1/reset.min.css">
  <!-- CSS -->
  <link rel="stylesheet" href="main.css">

</head>

<!-- FIXME:   TODO: -->

<body>
  
  <!-- root class -->
  <div class="root">
    <!-- <div class="modal"></div> -->
    <div class="inner">
      <div is="cardcontainer-comp"></div>
    </div>

  </div>
  <!-----------------------------------------------------------------------------------------------ğŸŸ¡ js ğŸŸ¡------------------------------------------------------------------------------------------------>
 
  <script>
  
    /* 1. CardContainer class  [ classë¡œ div ë§Œë“¤ê¸° -> HTMLDivElement ] */
    class CardContainer extends HTMLDivElement {
      /* ìƒì„±ì */
      constructor() {
        super()

        this.classList.add('card-container');

        this.posts = []
      }

      /* TODO: fetchë¡œ ë°ì´í„° ë°›ì•„ì˜¤ê¸°  */
      async getPosts() {
        const res = await fetch('http://localhost:3000/posts');
        this.posts = await res.json();
        console.log(this.posts)  // Array í˜•ì‹ìœ¼ë¡œ ë‹´ê²¨ ì˜¨ë‹¤ -> ê·¸ë˜ì„œ ìœ„ì—    this.posts = []  ì´ë ‡ê²Œ í‘œì‹œí•¨ 
      }

      async connectedCallback(){
        await this.getPosts();   // ì œì¼ ë¨¼ì € ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°  
        this.render();
      }

      render() {
        this.posts.forEach(post=>{
          this.appendChild( new Card() ); // ğŸŸ¢ postì˜ ê°œìˆ˜ ë§Œí¼ Card ìƒì„± ğŸŸ¢
        })
        
      }
    }
    customElements.define("cardcontainer-comp", CardContainer, {extends: 'div'})


    /* ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- */



    /* 2. Card class */
    class Card extends HTMLDivElement {
      constructor(){
        super()
        this.classList.add('card');
        this.style.marginBottom='50px';
      }
      connectedCallback(){
        this.append(
            new UserAcct(), 
            new MainImg(), 
            new UserWrite(), 
            // new Moreview(), 
            new Comment()
        )
      }
    }
    customElements.define("card-comp", Card, {extends: 'div'})


    /* 3. ëª¨ë‹¬ */ 
    class Modal extends HTMLElement {
   

      async connectedCallback() {
        await this.getPosts();
        this.innerHTML =
          `<div class="modal">
              </div>
           </div>`;
      }
    }
    customElements.define('modal-comp', Modal)


/* ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- */



    /* 4. UserAcct í´ë˜ìŠ¤ */
    class UserAcct extends HTMLElement {
    
      // 1ì°¨ ì‹¤í–‰
      constructor() {
        super();
        this.user_id
        this.posts = [];

        this.innerHTML =
          `<div class="top">
          <div class="top-container">
            <div class="top-item-image">
              <!-- FIXME: src: ë³€ê²½í•´ì•¼ë¨  --> 
              <img class="top-img" src="/img/box.png" alt="no_picture"> 
            </div>
            <div class="top-item-account">
              <!-- FIXME: ì´ë¦„: ë³€ê²½í•´ì•¼ë¨  --> 
              <span class="account"><strong id="userAcct">ichiban1001</strong></span>
            </div>
            <div class="top-item-mark">
              <img class="check-img" src="/img/check.png" alt="no_picture">
            </div>
          </div>
        </div>`;
      }
      // // 2ì°¨ ì‹¤í–‰  
      // async connectedCallback() {
      //   await this.getPosts()
      //   this.setTopimg();
      // }
      // setTopimg() {
      //   this.querySelector('.top-img').src = this.posts[0].post_img;
      //   // document.querySelector('.top-img').src = '/img/ketty5.png';
      // }
    }
    customElements.define('useraccount-comp', UserAcct);



    class CreateImg extends HTMLElement {
    constructor(){
      super();
      this.posts = []
    } 

    async connectedCallback(){
      await this.getPosts();
      this.render();
    }

    /*  fetchë¡œ ë°ì´í„° ë°›ì•„ì˜¤ê¸°  */
    async getPosts() {
    const res = await fetch('http://localhost:3000/posts');
    this.posts = await res.json();   // Array í˜•ì‹ìœ¼ë¡œ ë‹´ê²¨ ì˜¨ë‹¤ -> ê·¸ë˜ì„œ ìœ„ì—    this.posts = []  ì´ë ‡ê²Œ í‘œì‹œí•¨ 
    // console.log(this.posts) 
    }

    render() {
      // 1.ul íƒœê·¸ ë§Œë“¤ê¸° 
      const ul_element = document.createElement('ul');
      ul_element.className = 'items';

      this.appendChild(ul_element);
      console.log("í¬ìŠ¤íŠ¸ ìˆë‚˜ ì—†ë‚˜");
      console.log(this.posts);
      // 2. postsì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ ,ë°ì´í„° ìˆ˜ë§Œí¼ ì´ë¯¸ì§€ ìƒì„±
      this.posts.forEach( (post ,i) => {
        
        // 2.1 li ìƒì„±
        const li_element = document.createElement('li');
        li_element.className = 'item';
        ul_element.appendChild(li_element);
        
        // 2.2 image ìƒì„±
        const img_element = document.createElement('img');
        img_element.className = 'main-img';
        img_element.src = post.post_main_img[i]
        li_element.appendChild(img_element);
        
      })

      // this.appendChild('.items')
     }

    }
     customElements.define('sendingimg-comp',CreateImg)



    /* 5. MainImg í´ë˜ìŠ¤ */
    class MainImg extends HTMLElement {

      constructor() {
        super();
        this.nowPage = 1;
        this.nowPosition = 0;
        this.PageLength = 0;
        this.innerHTML =
          `<div class="main-container">
              <button class="prevButton">&lt;</button>
              <button class="nextButton">&gt;</button>
             
           </div>`;
        this.appendChild(new CreateImg());

        this.items = this.querySelector('.items');

        this.nextButton = this.querySelector('.main-container .nextButton');
        this.prevButton = this.querySelector('.main-container .prevButton');

        // this.nextButton.addEventListener('click' ,() => this.nextTransition())
        // this.prevButton.addEventListener('click' ,() => this.prevTransition())
        /* bind(this)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆì— ë©”ì„œë“œì˜ this ê°’ì„ ì—°ê²° */
        this.nextButton.addEventListener('click', this.nextTransition.bind(this));
        this.prevButton.addEventListener('click', this.prevTransition.bind(this));
      }

      // itemsRender() {
      //   this.items.innerHTML = '';
      //   this.nmbvnmb.forEach((item) => {
      //     this.items.innerHTML += itemTemplate(item);
      //   })
      // }

      // itemTemplate({ img }) {
      //   return `<li class="item"><img class="main-img" src="${img}" alt="no_picture"></li>`
      // }


      // 2ì°¨ ì‹¤í–‰
      connectedCallback() {
        this.initializeCarousel();
      }

      // ì´ˆê¸°í™”
      initializeCarousel() {
        let $items = this.querySelector('.items');
        let $prevButton = this.querySelector('.prevButton');
        let $nextButton = this.querySelector('.nextButton');
        let $mainImg = this.querySelector('.main-img'); // FIXME: 
        this.PageLength = $items.getElementsByTagName('li').length; // ì´ ì‚¬ì§„ ê°¯ìˆ˜ ë§Œí¼ ë³€í™”
        if (this.nowPage == 1) {
          $prevButton.classList.add('no_visible');
        }
      }

      // 2.1 ìš°ì¸¡ ë²„íŠ¼
      nextTransition() {
        console.log(this);
          this.nowPage++;
          console.log(this.nowPage);

          if (this.nowPage > 1) {
            this.prevButton.classList.remove('no_visible');
          }

          if (this.nowPage == this.PageLength) {
            this.nextButton.classList.add('no_visible');
          }

          this.nowPosition -= 800;
          console.log(this.nowPosition);
          this.items.style.transform = `translateX(${this.nowPosition}px)`;
      }

      // 2.2 ì¢Œì¸¡ ë²„íŠ¼
      prevTransition() {
          this.nowPage--;
          console.log(this.nowPage);

          if (this.nowPage == 1) {
            this.prevButton.classList.add('no_visible');
          }

          if (this.nowPage < this.PageLength) {
            this.nextButton.classList.remove('no_visible');
          }

          this.nowPosition += 800;
          console.log(this.nowPosition);
          this.items.style.transform = `translateX(${this.nowPosition}px)`;
      }
    }
    customElements.define('mainimg-comp', MainImg)




    /* â¤ï¸ 6. UserWrite í´ë˜ìŠ¤ */
    class UserWrite extends HTMLElement {
      // 1ì°¨ ì‹¤í–‰
      constructor() {
        super()
        this.countLike = 0;
        this.innerHTML = `
        <div class="user-heart ">
          <img class="user-img"  src="/img/heart1.png" alt="no_picture" >
          <div class="user-count"><strong>0</strong></div>
          <div class="user-like">ëª…ì´ ì¢‹ì•„í•©ë‹ˆë‹¤</div>
        </div>
        <div class="user-write">
          <div class="user-tag">
            <span id="account">ichiban1001</span>
            é€ƒã‚Œé€ƒã‚Œã¤ã„ãŸã‚ã‚‹ã‚«ãƒ•ã‚§ï½ï½ï¼ã™ã£ã”ãå±…å¿ƒåœ°ã‚ˆãã¦æ™‚é–“ã®ã‚ã‚‹æ–¹ã€…ã«ã¯ãœã²ãŠå‹§ã‚ã„ãŸã—ã¾ã™ï¼ï¼
            æµã‚Œã¦ãã‚‹éŸ³æ¥½ã‚‚é›°å›²æ°—ã¨ãƒ”ãƒƒã‚¿ãƒªãªã®ã§ä¹…ã€…ã«ã®ã‚“ã³ã‚Šã—ãŸã„äººãŸã¡ã«ã‚‚ã„ã„ã¨æ€ã„ã¾ã™ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼
            æµã‚Œã¦ãã‚‹éŸ³æ¥½ã‚‚é›°å›²æ°—ã¨ãƒ”ãƒƒã‚¿ãƒªãªã®ã§ä¹…ã€…ã«ã®ã‚“ã³ã‚Šã—ãŸã„äººãŸã¡ã«ã‚‚ã„ã„ã¨æ€ã„ã¾ã™ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼
            æµã‚Œã¦ãã‚‹éŸ³æ¥½ã‚‚é›°å›²æ°—ã¨ãƒ”ãƒƒã‚¿ãƒªãªã®ã§ä¹…ã€…ã«ã®ã‚“ã³ã‚Šã—ãŸã„äººãŸã¡ã«ã‚‚ã„ã„ã¨æ€ã„ã¾ã™ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼
         
          </div>
        </div>
        <div class="btnBar">
          <button id="showMore">ë”ë³´ê¸°</button>
        </div>
        <div>
          <button id="showAll">ëŒ“ê¸€ ëª¨ë‘ ë³´ê¸°</button>
        </div>`
      }

      // 2ì°¨ ì‹¤í–‰
      async connectedCallback() {
        this.posts = []
        this.clickLike();
        this.moreViewPosts();
        this.moreViewComments();
        this.removeViewComments();
        await this.getPosts();
   
      }
      
      clickLike() {
        let $userImg = document.querySelector('.user-img'); // í•˜íŠ¸ ì´ë¯¸ì§€
        let $userCount = document.querySelector('.user-count'); // ì¢‹ì•„ìš” ìˆ˜
        $userImg.addEventListener('click', () => {
          
          this.countLike++
          this.pushPatch();
          if (this.countLike >= 1) {
            $userImg.src = '/img/heart2.png';
          }
          $userCount.textContent = this.countLike;
        })
      }

      // Patchìš”ì²­ - likesë§Œ ìˆ˜ì •
      async pushPatch() {
       await fetch(`http://localhost:3000/posts/1`,{
          method : "PATCH", // ì¼ë¶€ë§Œ ìˆ˜ì •
          headers: {"Content-Type": "application/json",},
          body: JSON.stringify({
          likes: `${this.countLike+1}`}), // titleë§Œ ë°”ê¿ˆ. ë‚˜ë¨¸ì§€ ìš”ì†ŒëŠ” ê±´ë“¤ì§€ ì•ŠìŒ.
          
       })
       .then((response) => response.json())
       .then((data) => this.posts)
      }

      async getPosts() {
        const res = await fetch('http://localhost:3000/posts');
        this.posts = await res.json();
        console.log(this.posts)  // Array í˜•ì‹ìœ¼ë¡œ ë‹´ê²¨ ì˜¨ë‹¤ -> ê·¸ë˜ì„œ ìœ„ì—    this.posts = []  ì´ë ‡ê²Œ í‘œì‹œí•¨ 
      }


      // 6.1 ì‚¬ìš©ìê°€ ì‘ì„±í•œ ê¸€ ë”ë³´ê¸° 
      moreViewPosts() {
        let $showMore = this.querySelector('#showMore');
        let $userWrite = this.querySelector('.user-write');
        $showMore.addEventListener('click', () => {
          $userWrite.classList.toggle('user-tag-on');
        });
      }

      // 6.2 ëª¨ë‹¬ - ëŒ“ê¸€ ëª¨ë‘ ë³´ê¸°
      moreViewComments() {
        let $showAll = this.querySelector('#showAll');
        let $modal = document.querySelector('.modal');
        let $body = document.querySelector('body');
        
        // let $container = this.querySelector('.container');
        let $root = document.querySelector('.root');
        $showAll.addEventListener('click', () => {
          $modal.classList.add('visible');
          $body.classList.add('bgBlur');
        })
      }
      
      // 6.3 ëª¨ë‹¬ ì œê±°
      removeViewComments() {
        let $modal = document.querySelector('.modal')
        let $root = document.querySelector('.root');
        let $body = document.querySelector('body');
        $root.addEventListener('click', (e) => {
          if (e.target === $root) {
            $modal.classList.remove('visible');
            $body.classList.remove('bgBlur');
            console.log("zfzfzfzfz")
          }
        })
      }



    }
    customElements.define('userwrite-comp', UserWrite)




    /* 4. Moreview í´ë˜ìŠ¤ */
    // class Moreview extends HTMLElement {
    //   // 1ì°¨ ì‹¤í–‰
    //   constructor() {
    //     super();
    //     this.innerHTML =
    //       `
    //     `;
    //   }
    //   // 2ì°¨ ì‹¤í–‰
    //   connectedCallback() {
       
    //   }

      
    // }
    // customElements.define('moreview-comp', Moreview)




    /* 7. Comment í´ë˜ìŠ¤ */
    class Comment extends HTMLElement {
      // 1ì°¨ ì‹¤í–‰
      constructor() {
        super();
        this.innerHTML =
          `<div class="comment">
          <textarea  class="comment-input" style="overflow:hidden; resize:none;" placeholder="ëŒ“ê¸€ ë‹¬ê¸°..." id="myField"></textarea>
          <div class="comment-push">
           <button class="btn-push">ê²Œì‹œ</button>
          </div>
        </div>`
      }
      // 2ì°¨ ì‹¤í–‰
      connectedCallback() {
        this.clickPostBtn();
      }
      // 7.1 ê²Œì‹œ ë²„íŠ¼ í´ë¦­
      clickPostBtn() {
        this.userInput = '';
        let commentInput = document.querySelector('.comment-input')
        let btnPush = document.querySelector('.btn-push')
        commentInput.addEventListener('input', (e) => {
          this.userInput = e.target.value;
        })
        btnPush.addEventListener('click', () => {
          console.log(this.userInput);
          commentInput.value = '';
        });
      }
    }
    customElements.define('comment-comp', Comment)


  </script>
  <!-- ğŸŸ¡ /js ğŸŸ¡   -->
</body>

</html>